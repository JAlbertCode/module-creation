            Prism.highlightElement(preview);
        }

        function updateValidationResults() {
            if (!currentValidation) return;
            
            const resultsDiv = document.getElementById('validation-results');
            let html = '';
            
            for (const [file, errors] of Object.entries(currentValidation)) {
                html += `<div class="mb-4">
                    <h3 class="font-semibold">${file}</h3>
                    ${errors.length === 0 
                        ? '<p class="validation-success">✓ Valid</p>'
                        : errors.map(err => `<p class="validation-error">✗ ${err}</p>`).join('')}
                </div>`;
            }
            
            resultsDiv.innerHTML = html;
        }

        async function testModule() {
            const modelUrl = document.getElementById('model-url').value;
            const testInput = document.getElementById('test-input').value;
            
            if (!modelUrl || !testInput) {
                alert('Please provide both model URL and test input');
                return;
            }
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p class="text-gray-600">Running test...</p>';
            
            try {
                const response = await fetch('/api/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ modelUrl, input: testInput })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultsDiv.innerHTML = `
                        <div class="text-red-600">
                            <p class="font-semibold">Error:</p>
                            <p>${data.error}</p>
                        </div>`;
                } else {
                    resultsDiv.innerHTML = `
                        <div>
                            <p class="font-semibold">Results:</p>
                            <pre class="bg-gray-100 p-2 rounded mt-2 overflow-x-auto">
${JSON.stringify(data.results, null, 2)}</pre>
                            ${data.logs ? `
                                <p class="font-semibold mt-4">Logs:</p>
                                <pre class="bg-gray-100 p-2 rounded mt-2 overflow-x-auto">${data.logs}</pre>
                            ` : ''}
                        </div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600">
                        <p class="font-semibold">Error:</p>
                        <p>${error.message}</p>
                    </div>`;
            }
        }

        async function downloadFiles() {
            const modelUrl = document.getElementById('model-url').value;
            
            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ modelUrl })
                });

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lilypad-module.zip';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (error) {
                console.error('Error:', error);
                alert('Error downloading files: ' + error.message);
            }
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab content
            document.getElementById(`tab-content-${tabName}`).classList.remove('hidden');
            
            // Update tab styles
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-blue-100', 'text-blue-700');
                tab.classList.add('text-gray-500', 'hover:text-gray-700');
            });
            
            const selectedTab = document.getElementById(`tab-${tabName}`);
            selectedTab.classList.remove('text-gray-500', 'hover:text-gray-700');
            selectedTab.classList.add('bg-blue-100', 'text-blue-700');
        }

        // Initialize by showing files tab
        showTab('files');
    </script>
</body>
</html>